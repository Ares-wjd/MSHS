<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>책 추천</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 30px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #4a90e2;
      color: white;
      font-size: 1em;
      cursor: pointer;
    }
    .btn:hover {
      background: #357ab7;
    }
    .hidden {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    input[type="text"] {
      padding: 10px;
      width: 60%;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>책 추천 시스템</h1>

  <div style="margin: 30px 0; text-align: center;">
    <input type="text" id="searchInput" placeholder="도서명 또는 저자명 검색">
    <button class="btn" onclick="searchKeyword()">검색</button>
  </div>

  <div id="level1" class="btn-group">
    <button class="btn" onclick="selectSubject('국어')">국어</button>
    <button class="btn" onclick="selectSubject('수학')">수학</button>
    <button class="btn" onclick="selectSubject('영어')">영어</button>
    <button class="btn" onclick="selectSubject('사회')">사회</button>
    <button class="btn" onclick="selectSubject('과학')">과학</button>
    <button class="btn" onclick="selectSubject('기술가정')">기술가정</button>
    <button class="btn" onclick="selectSubject('예체능')">예체능</button>
  </div>

  <div id="results" class="hidden"></div>

  <script>
    let bookData = [];

    const subjectToCategories = {
      "국어": [["국어", "언어와 매체"]],
      "수학": [["자연과학", "수학"]],
      "영어": [["영어", "기타"]],
      "사회": [["사회", "정치"], ["사회", "동아시아사"], ["사회", "세계지리"], ["사회", "경제"]],
      "과학": [["과학", "물리"], ["과학", "화학"], ["과학", "생명과학"], ["과학", "지구과학"]],
      "기술가정": [["기술가정", "정보/인공지능"]],
      "예체능": [["예체능", "미술"], ["예체능", "음악"], ["예체능", "체육"]],
    };

    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("dlsExportList_final.json");
        bookData = await res.json();
        console.log("도서 데이터 로드 완료");
      } catch (error) {
        alert("dlsExportList_final.json 파일을 불러오는 데 실패했습니다.");
        console.error(error);
      }
    });

    function selectSubject(subject) {
      const resultsDiv = document.getElementById("results");
      if (!bookData.length) {
        resultsDiv.innerHTML = "<p>도서 데이터를 아직 불러오지 못했습니다.</p>";
        resultsDiv.classList.remove("hidden");
        return;
      }

      const filters = subjectToCategories[subject] || [];
      const filtered = bookData.filter(row =>
        filters.some(([c1, c2]) =>
          row["1차분류"] === c1 && row["2차분류"] === c2
        )
      );

      displayResults(filtered);
    }

    function searchKeyword() {
      const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
      if (!keyword || bookData.length === 0) return;
      const filtered = bookData.filter(row => {
        return (
          row["자료명"]?.toLowerCase().includes(keyword) ||
          row["저자"]?.toLowerCase().includes(keyword)
        );
      });
      displayResults(filtered);
    }

    function displayResults(filtered) {
      const resultsDiv = document.getElementById("results");
      if (filtered.length === 0) {
        resultsDiv.innerHTML = "<p>조건에 맞는 도서가 없습니다.</p>";
      } else {
        const table = document.createElement("table");
        table.innerHTML = `
          <thead>
            <tr><th>자료명</th><th>저자</th><th>출판사</th><th>청구기호</th></tr>
          </thead>
          <tbody>
            ${filtered.map(row => `
              <tr>
                <td>${row["자료명"]}</td>
                <td>${row["저자"]}</td>
                <td>${row["출판사"]}</td>
                <td>${row["청구기호"]}</td>
              </tr>
            `).join("")}
          </tbody>
        `;
        resultsDiv.innerHTML = "";
        resultsDiv.appendChild(table);
      }
      resultsDiv.classList.remove("hidden");
    }
  </script>
</body>
</html>
